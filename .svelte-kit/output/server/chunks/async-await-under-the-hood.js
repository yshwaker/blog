import { c as create_ssr_component } from "./ssr.js";
const metadata = {
  "title": "async/await æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ",
  "date": "2022-07-17",
  "summary": "ES2017 å¼•å…¥äº†`Async/Await`è¯­æ³•ï¼Œä½¿å¾—æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯åŒæ­¥ä»£ç ï¼Œéšè—äº†æˆå †çš„å›è°ƒå‡½æ•°ã€‚ä½†æ˜¯ Javascript å¼•æ“å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ",
  "updatedOn": "2025-08-16T15:41:37.970Z"
};
const { title, date, summary, updatedOn } = metadata;
const Async_await_under_the_hood = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  return `<p data-svelte-h="svelte-1pzdxqk">ES2017 å¼•å…¥äº†<code>Async/Await</code>è¯­æ³•ï¼Œä½¿å¾—æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯åŒæ­¥ä»£ç ï¼Œéšè—äº†æˆå †çš„å›è°ƒå‡½æ•°ã€‚ä½†æ˜¯ Javascript å¼•æ“å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p> <h2 data-svelte-h="svelte-iv4go9">å…ˆæ¥çœ‹çœ‹ Babel çš„å®ç°</h2> <p data-svelte-h="svelte-1js1eq2">åœ¨å‰å‡ å¹´æµè§ˆå™¨è¿˜æ²¡æœ‰å®Œå…¨åŸç”Ÿæ”¯æŒ<code>async</code>è¯­æ³•æ—¶ï¼Œä¸ºäº†æŠ¢å…ˆä½“éªŒ ECMA Spec ä¸­çš„æ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Babel å°†æœ€æ–°è¯­æ³•è½¬è¯‘<code>Transpile</code>æˆæµè§ˆå™¨æ”¯æŒçš„è¯­æ³•ç»“æ„</p> <p data-svelte-h="svelte-iplkh4">å¦‚ï¼š</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8" tabindex="0"><code><span class="line"><span style="color:#C792EA">async</span><span style="color:#C792EA"> function</span><span style="color:#82AAFF"> foo</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">url</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  try</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">    const</span><span style="color:#BABED8"> response</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF;font-style:italic"> await</span><span style="color:#82AAFF"> fetch</span><span style="color:#F07178">(</span><span style="color:#BABED8">url</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#BABED8">    console</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">log</span><span style="color:#F07178">(</span><span style="color:#89DDFF;font-style:italic">await</span><span style="color:#BABED8"> response</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">text</span><span style="color:#F07178">())</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">  }</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  catch</span><span style="color:#F07178"> (</span><span style="color:#BABED8">err</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#BABED8">    console</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">log</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">fetch failed</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> err</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">  }</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-1v7b1bz">è½¬è¯‘æˆäº†</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8" tabindex="0"><code><span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> asyncGeneratorStep</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">gen</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> resolve</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> reject</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> _next</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> _throw</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> key</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> arg</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span><span style="color:#89DDFF;font-style:italic"> try</span><span style="color:#89DDFF"> {</span><span style="color:#C792EA"> var</span><span style="color:#BABED8"> info</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> gen</span><span style="color:#F07178">[</span><span style="color:#BABED8">key</span><span style="color:#F07178">](</span><span style="color:#BABED8">arg</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#C792EA"> var</span><span style="color:#BABED8"> value</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> info</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">value</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> catch</span><span style="color:#F07178"> (</span><span style="color:#BABED8">error</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span><span style="color:#82AAFF"> reject</span><span style="color:#F07178">(</span><span style="color:#BABED8">error</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF;font-style:italic"> return</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> if</span><span style="color:#F07178"> (</span><span style="color:#BABED8">info</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">done</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span><span style="color:#82AAFF"> resolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">value</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#89DDFF"> {</span><span style="color:#FFCB6B"> Promise</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">resolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">value</span><span style="color:#F07178">)</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">then</span><span style="color:#F07178">(</span><span style="color:#BABED8">_next</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> _throw</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#89DDFF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> _asyncToGenerator</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">fn</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span><span style="color:#89DDFF;font-style:italic"> return</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF"> ()</span><span style="color:#89DDFF"> {</span><span style="color:#C792EA"> var</span><span style="color:#BABED8"> self</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF"> this,</span><span style="color:#BABED8"> args</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> arguments</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF;font-style:italic"> return</span><span style="color:#89DDFF"> new</span><span style="color:#FFCB6B"> Promise</span><span style="color:#F07178">(</span><span style="color:#C792EA">function</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">resolve</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> reject</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span><span style="color:#C792EA"> var</span><span style="color:#BABED8"> gen</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> fn</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">apply</span><span style="color:#F07178">(</span><span style="color:#BABED8">self</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> args</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#C792EA"> function</span><span style="color:#82AAFF"> _next</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">value</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span><span style="color:#82AAFF"> asyncGeneratorStep</span><span style="color:#F07178">(</span><span style="color:#BABED8">gen</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> resolve</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> reject</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> _next</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> _throw</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">next</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> value</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#C792EA"> function</span><span style="color:#82AAFF"> _throw</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">err</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span><span style="color:#82AAFF"> asyncGeneratorStep</span><span style="color:#F07178">(</span><span style="color:#BABED8">gen</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> resolve</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> reject</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> _next</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> _throw</span><span style="color:#89DDFF">,</span><span style="color:#89DDFF"> "</span><span style="color:#C3E88D">throw</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> err</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#82AAFF"> _next</span><span style="color:#F07178">(</span><span style="color:#89DDFF">undefined</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> }</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span><span style="color:#89DDFF"> };</span><span style="color:#89DDFF"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> foo</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">_x</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  return</span><span style="color:#BABED8"> _foo</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">apply</span><span style="color:#F07178">(</span><span style="color:#89DDFF">this,</span><span style="color:#BABED8"> arguments</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> _foo</span><span style="color:#89DDFF">()</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">  _foo</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> _asyncToGenerator</span><span style="color:#F07178">(</span><span style="color:#C792EA">function</span><span style="color:#89DDFF">*</span><span style="color:#82AAFF"> g_foo</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">url</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    try</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">      const</span><span style="color:#BABED8"> response</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF;font-style:italic"> yield</span><span style="color:#82AAFF"> fetch</span><span style="color:#F07178">(</span><span style="color:#BABED8">url</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#BABED8">      console</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">log</span><span style="color:#F07178">(</span><span style="color:#89DDFF;font-style:italic">yield</span><span style="color:#BABED8"> response</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">text</span><span style="color:#F07178">())</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">    }</span><span style="color:#89DDFF;font-style:italic"> catch</span><span style="color:#F07178"> (</span><span style="color:#BABED8">err</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#BABED8">      console</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">log</span><span style="color:#F07178">(</span><span style="color:#89DDFF">'</span><span style="color:#C3E88D">fetch failed</span><span style="color:#89DDFF">'</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> err</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">    }</span></span>
<span class="line"><span style="color:#89DDFF">  }</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  return</span><span style="color:#BABED8"> _foo</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">apply</span><span style="color:#F07178">(</span><span style="color:#89DDFF">this,</span><span style="color:#BABED8"> arguments</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-1xhnxoj">Babel æ›¿æˆ‘ä»¬ç”Ÿæˆäº†ä¸¤ä¸ª helper å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å®ƒç¨åŠ ç®€åŒ–ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8" tabindex="0"><code><span class="line"><span style="color:#C792EA">function</span><span style="color:#82AAFF"> _asyncToGenerator</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">fn</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  return</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF"> ()</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">    var</span><span style="color:#BABED8"> gen</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> fn</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">apply</span><span style="color:#F07178">(</span><span style="color:#89DDFF">this,</span><span style="color:#BABED8"> arguments</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">    return</span><span style="color:#89DDFF"> new</span><span style="color:#FFCB6B"> Promise</span><span style="color:#F07178">(</span><span style="color:#C792EA">function</span><span style="color:#89DDFF"> (</span><span style="color:#BABED8;font-style:italic">resolve</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">      function</span><span style="color:#82AAFF"> step</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">key</span><span style="color:#89DDFF">,</span><span style="color:#BABED8;font-style:italic"> arg</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">        var</span><span style="color:#BABED8"> info</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> gen</span><span style="color:#F07178">[</span><span style="color:#BABED8">key</span><span style="color:#F07178">](</span><span style="color:#BABED8">arg</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#C792EA">        var</span><span style="color:#BABED8"> value</span><span style="color:#89DDFF"> =</span><span style="color:#BABED8"> info</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">value</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">       if</span><span style="color:#F07178"> (</span><span style="color:#BABED8">info</span><span style="color:#89DDFF">.</span><span style="color:#BABED8">done</span><span style="color:#F07178">) </span><span style="color:#89DDFF">{</span></span>
<span class="line"><span style="color:#82AAFF">          resolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">value</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">        }</span><span style="color:#89DDFF;font-style:italic"> else</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">          // å¦‚æœvalueä¸æ˜¯ä¸€ä¸ªpromiseï¼Œåˆ™å°†å®ƒè½¬åŒ–æˆä¸€ä¸ªresolved promise</span></span>
<span class="line"><span style="color:#FFCB6B">          Promise</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">resolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">value</span><span style="color:#F07178">)</span><span style="color:#89DDFF">.</span><span style="color:#82AAFF">then</span><span style="color:#F07178">(</span><span style="color:#C792EA">function</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">val</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#82AAFF">            step</span><span style="color:#F07178">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">next</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> val</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">          },</span><span style="color:#C792EA"> function</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">err</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#82AAFF">            step</span><span style="color:#F07178">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">throw</span><span style="color:#89DDFF">"</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> err</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">          }</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">        }</span></span>
<span class="line"><span style="color:#89DDFF">      }</span></span>
<span class="line"><span style="color:#82AAFF">      step</span><span style="color:#F07178">(</span><span style="color:#89DDFF">"</span><span style="color:#C3E88D">next</span><span style="color:#89DDFF">"</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">    }</span><span style="color:#F07178">)</span><span style="color:#89DDFF">;</span></span>
<span class="line"><span style="color:#89DDFF">  };</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>`}<!-- HTML_TAG_END --> <h3 data-svelte-h="svelte-1v7o2e2">ç”Ÿæˆå™¨ Generator</h3> <p data-svelte-h="svelte-1o07asw">åœ¨è¿™é‡Œä¾‹å­ä¸­å¼‚æ­¥å‡½æ•°è¢«è½¬æ¢æˆäº†ç”Ÿæˆå™¨å‡½æ•°ã€‚è¿™é‡Œå…ˆç®€è¦å›é¡¾ä¸€ä¸‹ç”Ÿæˆå™¨ï¼š</p> <ul data-svelte-h="svelte-3x9whi"><li>é€šè¿‡<code>function* () {}</code>å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œå…¶è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</li> <li>è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°çš„<code>.next()</code>æ–¹æ³•åï¼Œå¼€å§‹æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°ä»£ç </li> <li>ç”Ÿæˆå™¨å¯¹è±¡ä¸­å¯ä½¿ç”¨<code>yield</code>å…³é”®å­—ï¼Œç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œæ—¶é‡åˆ°<code>yield</code>å°†æš‚åœå‡½æ•°çš„æ‰§è¡Œï¼Œè½¬è€Œæ‰§è¡Œ<code>.next()</code>ä¹‹åçš„ä»£ç </li> <li>å†æ¬¡è°ƒç”¨<code>.next()</code>æ–¹æ³•æ—¶ï¼Œä»ä¹‹å‰<code>yield</code>çš„ä½ç½®ç»§ç»­æ‰§è¡Œ</li></ul> <p data-svelte-h="svelte-ve19xp">ç”Ÿæˆå™¨å‡½æ•°ä¸ä¸»å‡½æ•°ä¹‹é—´å¯è¿›è¡Œæ•°æ®ä¼ é€’ï¼š</p> <ul data-svelte-h="svelte-wwpj3m"><li>ä¸»å‡½æ•° -&gt; ç”Ÿæˆå™¨å‡½æ•°ï¼š<code>gen.next(val)</code> å‚è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Generator/next#%E5%90%91%E7%94%9F%E6%88%90%E5%99%A8%E4%BC%A0%E5%80%BC" rel="nofollow">ğŸ”—</a></li> <li>ç”Ÿæˆå™¨å‡½æ•° -&gt; ä¸»å‡½æ•°ï¼š<code>yield val</code></li></ul> <h3 data-svelte-h="svelte-1yulp3t"><code>_asyncToGenerator </code>åœ¨å¹²ä»€ä¹ˆï¼Ÿ</h3> <p data-svelte-h="svelte-i2knj2">æˆ‘ä»¬çŸ¥é“åœ¨<code>async</code>å‡½æ•°<code>await</code>ä¸€ä¸ª promise å¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šç­‰åˆ°å®ƒ fulfilled ä»¥åå¼€å§‹æ‰§è¡Œåé¢çš„ä»£ç ã€‚åœ¨è½¬æ¢åçš„ç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼Œ<code>yield</code>ç›¸å½“äº<code>await</code>ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨<code>gen.next()</code>æ–¹æ³•æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°ï¼Œå–å¾—<code>yield fetch(url)</code>ä¸­çš„ promiseï¼Œå¹¶<code>.then()</code>æ–¹æ³•ä¸­è¿›è¡Œé€’å½’â€”â€”è°ƒç”¨<code>gen.next(arg)</code>ç»§ç»­æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°ï¼Œpromise resolve çš„å€¼é€šè¿‡<code>arg</code>ä¼ é€’ç»™ç”Ÿæˆå™¨å‡½æ•°, â€¦</p> <p data-svelte-h="svelte-1fjw9rp">å…·ä½“æ­¥éª¤ä¸ºï¼š</p> <ol data-svelte-h="svelte-vznels"><li><p>åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡<code>gen</code>ï¼Œasync å‡½æ•°è¿”å›ä¸€ä¸ª promise</p></li> <li><p>æ‰§è¡Œä¼ å…¥ promise çš„å‡½æ•°ï¼Œè°ƒç”¨<code>gen.next()</code>ï¼Œå¼•æ“è·³è½¬åˆ°ç”Ÿæˆå™¨å‡½æ•°<code>g_foo</code>å¼€å§‹æ‰§è¡Œ</p></li> <li><p>é‡åˆ°<code>yield</code>,æš‚åœå‡½æ•°æ‰§è¡Œï¼Œ<code>fetch(url)</code>è¿”å›ä¸€ä¸ª promiseï¼Œå¹¶è¢«ä¼ å›ç»™ä¸»å‡½æ•°ï¼Œèµ‹å€¼ç»™<code>info.value</code></p></li> <li><p>è°ƒç”¨<code>promise.then</code>è®¾ç½® resolved åçš„å›è°ƒå‡½æ•°ï¼Œ<code>_asyncToGenerator</code>ç»“æŸè¿è¡Œ</p></li> <li><p>æ­¤æ—¶å°†ç»§ç»­æ‰§è¡Œä¸»å‡½æ•°ä¸­çš„å‰©ä½™ä»£ç ã€‚</p></li> <li><p>å½“ fetch ä»æœåŠ¡å™¨å¾—åˆ°æ•°æ®åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå³<code>step</code>ï¼Œå¹¶å°†promise resolvedåçš„å€¼ä¼ å…¥å…¶ä¸­</p></li> <li><p>é‡å¤æ‰§è¡Œ2ï½6ï¼ŒçŸ¥é“ç”Ÿæˆå™¨å‡½æ•°è¿”å›ï¼Œ<code>done</code>ä¸ºçœŸ</p></li></ol> <h2 data-svelte-h="svelte-s67dv6">æµè§ˆå™¨ï¼ˆV8ï¼‰å®é™…æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ</h2> <p data-svelte-h="svelte-12kzb59">æ ¹æ® V8 å®˜æ–¹çš„ <a href="https://v8.dev/blog/fast-async#async-functions" rel="nofollow">blog</a>ï¼Œåœ¨ Node.js 12 çš„ä¸€ç³»åˆ—ä¼˜åŒ–åï¼Œ<code>async</code>å‡½æ•°åœ¨å†…éƒ¨è¢«è½¬åŒ–æˆäº†</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-theme-palenight" style="background-color:#292D3E;color:#babed8" tabindex="0"><code><span class="line"><span style="color:#C792EA">async</span><span style="color:#C792EA"> function</span><span style="color:#82AAFF"> foo</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">v</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#C792EA">  const</span><span style="color:#BABED8"> w</span><span style="color:#89DDFF"> =</span><span style="color:#89DDFF;font-style:italic"> await</span><span style="color:#BABED8"> v</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic">  return</span><span style="color:#BABED8"> w</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8">resumable </span><span style="color:#C792EA">function</span><span style="color:#82AAFF"> foo</span><span style="color:#89DDFF">(</span><span style="color:#BABED8;font-style:italic">v</span><span style="color:#89DDFF">)</span><span style="color:#89DDFF"> {</span></span>
<span class="line"><span style="color:#BABED8">  implicit_promise</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> createPromise</span><span style="color:#F07178">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">  // å¦‚æœvä¸æ˜¯promiseï¼Œåˆ™å°†å…¶è½¬åŒ–æˆpromise</span></span>
<span class="line"><span style="color:#BABED8">  promise</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> promiseResolve</span><span style="color:#F07178">(</span><span style="color:#BABED8">v</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">  // è®¾ç½®fulfilledå’Œrejectedæ—¶çš„å›è°ƒå‡½æ•°ï¼Œæ¢å¤fooçš„è¿è¡Œ</span></span>
<span class="line"><span style="color:#82AAFF">  performPromiseThen</span><span style="color:#F07178">(</span><span style="color:#BABED8">promise</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    res</span><span style="color:#C792EA"> =></span><span style="color:#82AAFF"> resume</span><span style="color:#F07178">(</span><span style="color:#89DDFF">&#x3C;&#x3C;</span><span style="color:#BABED8">foo</span><span style="color:#89DDFF">>>,</span><span style="color:#BABED8"> res</span><span style="color:#F07178">)</span><span style="color:#89DDFF">,</span></span>
<span class="line"><span style="color:#BABED8;font-style:italic">    err</span><span style="color:#C792EA"> =></span><span style="color:#82AAFF"> throw</span><span style="color:#F07178">(</span><span style="color:#89DDFF">&#x3C;&#x3C;</span><span style="color:#BABED8">foo</span><span style="color:#89DDFF">>>,</span><span style="color:#BABED8"> err</span><span style="color:#F07178">))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic">  // æŒ‚èµ·fooï¼Œå¹¶è¿”å›éšå¼åˆ›å»ºçš„promise</span></span>
<span class="line"><span style="color:#BABED8">  w</span><span style="color:#89DDFF"> =</span><span style="color:#82AAFF"> suspend</span><span style="color:#F07178">(</span><span style="color:#89DDFF">&#x3C;&#x3C;</span><span style="color:#BABED8">foo</span><span style="color:#89DDFF">>>,</span><span style="color:#BABED8"> implicit_promise</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#82AAFF">  resolvePromise</span><span style="color:#F07178">(</span><span style="color:#BABED8">implicit_promise</span><span style="color:#89DDFF">,</span><span style="color:#BABED8"> w</span><span style="color:#F07178">)</span></span>
<span class="line"><span style="color:#89DDFF">}</span></span></code></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-ntlq3a">è§‚å¯Ÿå‘ç°ä»£ç ç»“æ„å…¶å®ä¸ Babel polyfill ååˆ†ç›¸ä¼¼ï¼Œå†…éƒ¨åŒæ ·ä½¿ç”¨Promiseï¼Œ<code>resume</code>å’Œ<code>suspend</code>è¿™äº›å¼•æ“å†…éƒ¨å‡½æ•°ä¸ generator ä¹Ÿæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚<code>performPromiseThen</code>åœ¨å¼•æ“çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ›å»ºäº†<a href="https://tc39.es/ecma262/#sec-promisereactionjob" rel="nofollow">PromiseReactionJob</a>,ä¸å›è°ƒå‡½æ•°ç»‘å®šã€‚å½“ä¸»å‡½æ•°è¿è¡Œå®Œï¼Œä¸”awaitçš„promise resolveäº†ä¹‹åï¼Œæ‰§è¡Œå¾®ä»»åŠ¡ï¼Œæ¢å¤fooå‡½æ•°çš„æ‰§è¡Œã€‚</p>`;
});
export {
  Async_await_under_the_hood as default,
  metadata
};
